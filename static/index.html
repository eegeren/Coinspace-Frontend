<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Coinspace AI</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white font-sans">

  <!-- NAVBAR -->
  <nav class="bg-gray-800 px-6 py-4 shadow-md">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold tracking-wide text-indigo-400">Coinspace</a>
      <div class="space-x-4">
        <a href="index.html" class="text-sm text-indigo-400 font-semibold">Home</a>
        <a href="backtest.html" class="text-sm text-gray-300 hover:text-white">Backtest</a>
        <a href="news.html" class="text-sm text-gray-300 hover:text-white">News</a>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">

    <!-- SOL: GRAFÄ°K + TABLO + SÄ°NYAL + TAKVÄ°M -->
    <div class="lg:col-span-2 space-y-6">

      <!-- CHART -->
      <div class="bg-gray-800 rounded-xl shadow p-4">
        <h2 class="text-xl font-semibold mb-2 text-indigo-400">Live Crypto Chart</h2>
        <iframe 
          src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_4e7c3&symbol=BINANCE:BTCUSDT&interval=30&hidesidetoolbar=1&theme=dark"
          width="100%" height="400" frameborder="0" allowtransparency="true" scrolling="no">
        </iframe>
      </div>

      <!-- COIN TABLE -->
     <table id="coin-table">
       <thead>
        <tr><th>Coin</th><th>Price</th><th>Change</th></tr>
       </thead>
       <tbody></tbody>
       </table>


      <!-- AI SIGNAL -->
     <div id="ai-signal-box">
        <h3>AI Daily Signal</h3>
        <p id="signal-text">Loading...</p>
        <p id="accuracy-text"></p>
     </div>


      <!-- ECONOMIC CALENDAR -->
      <div id="calendar-box">
       <h3>Mini Economic Calendar</h3>
        <ul id="calendar-list"></ul>
      </div>


    <!-- SAÄž: HABERLER -->
    <div class="bg-gray-800 rounded-xl shadow p-4 relative h-[800px] overflow-auto">
      <h2 class="text-xl font-semibold mb-4 text-indigo-400">Latest News</h2>
      <div id="newsScroller" class="space-y-4 text-sm"></div>
    </div>

  </main>

  <!-- YATIRIMCI NOTU -->
  <section class="max-w-4xl mx-auto bg-gray-800 text-white p-6 mt-10 rounded-xl shadow">
    <h2 class="text-xl font-semibold text-indigo-400 mb-2">ðŸ’¡ Investor Tip of the Day</h2>
    <p id="tipText" class="text-gray-300 text-sm"></p>
  </section>

  <!-- FOOTER -->
  <footer class="bg-gray-800 text-center py-6 mt-12 border-t border-gray-700">
    <p class="text-gray-400 text-sm">Â© 2025 Coinspace. All rights reserved.</p>
  </footer>

  <!-- JS -->
  <script>
    // NEWS
    function loadNews() {
      fetch("http://127.0.0.1:8000/api/news")
        .then(res => res.json())
        .then(data => {
          const scroller = document.getElementById("newsScroller");
          const limited = data.slice(0, 10);
          scroller.innerHTML = limited.map(n => `
            <div class="bg-gray-700 p-3 rounded hover:bg-gray-600 transition">
              <h3 class="text-sm font-semibold">${n.title}</h3>
              <p class="text-xs text-gray-400 mt-1">${n.description.slice(0, 60)}...</p>
              <a href="${n.link}" target="_blank" class="text-indigo-400 text-xs mt-2 inline-block hover:underline">Read more â†’</a>
            </div>
          `).join('');
        });
    }

    // AI SIGNAL
    function fetchAISignal() {
      fetch('http://127.0.0.1:8000/api/signal')
        .then(res => res.json())
        .then(data => {
          document.getElementById("signal-status").innerText = data.signal;
          document.getElementById("signal-status").classList.remove("text-green-400", "text-red-400", "text-yellow-400");

          if (data.signal === "BUY") {
            document.getElementById("signal-status").classList.add("text-green-400");
          } else if (data.signal === "SELL") {
            document.getElementById("signal-status").classList.add("text-red-400");
          } else {
            document.getElementById("signal-status").classList.add("text-yellow-400");
          }

          document.getElementById("signal-accuracy").innerText = data.accuracy;
        });
    }

    // COIN TABLE
    fetch("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=5")
      .then(res => res.json())
      .then(data => {
        const tbody = document.getElementById("coin-table-body");
        tbody.innerHTML = data.map(coin => `
          <tr class="border-t border-gray-700">
            <td class="flex items-center gap-2 px-4 py-3">
              <img src="${coin.image}" alt="${coin.name}" class="w-5 h-5">
              ${coin.name} (${coin.symbol.toUpperCase()})
            </td>
            <td class="text-center px-4 py-3">$${coin.current_price.toLocaleString()}</td>
            <td class="text-center px-4 py-3 ${coin.price_change_percentage_24h >= 0 ? 'text-green-400' : 'text-red-400'}">
              ${coin.price_change_percentage_24h.toFixed(2)}%
            </td>
          </tr>
        `).join('');
      });

    // TIP
    const tips = [
      "Diversify your portfolio to reduce risk exposure.",
      "Don't invest money you can't afford to lose.",
      "Avoid FOMO â€“ never chase hype without doing research.",
      "Use stop-loss orders to limit potential losses.",
      "Invest with a long-term perspective, not short-term emotion.",
      "Always store your assets in secure wallets, not exchanges.",
    ];
    document.getElementById("tipText").textContent = tips[Math.floor(Math.random() * tips.length)];

    // INIT
    loadNews();
    fetchAISignal();
    setInterval(loadNews, 5 * 60 * 1000);
</script>

  <script>
    async function loadRealData() {
      try {
        const signalRes = await fetch('/api/signal');
        const signalData = await signalRes.json();
        document.getElementById('signal-text').innerText = signalData.signal;
        document.getElementById('signal-accuracy').innerText = signalData.accuracy + '%';

        const newsRes = await fetch('/api/news');
        const newsData = await newsRes.json();
        const newsList = document.getElementById('news-list');
        newsData.forEach(n => {
          const li = document.createElement('li');
          li.innerText = n.title;
          newsList.appendChild(li);
        });

      } catch (err) {
        console.error('Veri Ã§ekme hatasÄ±:', err);
      }
    }

    window.onload = loadRealData;
    </script>

</body>
</html>
